# AI助手问题排查指南

## 📋 问题：AI模型信息不显示

### ✅ 已完成的修复

1. **Token获取问题**：已修复，现在会优先使用`adminToken`
2. **错误信息显示**：现在会在页面上直接显示错误信息，无需打开控制台
3. **自动加载**：页面加载时会自动尝试加载AI信息

### 🔍 排查步骤

#### 步骤1：刷新页面
1. 刷新 `admin.html` 页面（按 `F5` 或 `Cmd+R`）
2. 确保已登录（右上角显示用户名）

#### 步骤2：检查Evo设置页面
1. 点击左侧菜单的 **"Evo设置"**
2. 向下滚动，找到 **"🤖 AI 模型信息"** 部分
3. 查看是否显示：
   - ✅ **成功**：显示模型名称、服务提供商等信息
   - ❌ **失败**：显示红色错误信息框

#### 步骤3：查看错误信息
如果显示错误信息，请查看错误框中的内容：

**常见错误及解决方法：**

1. **❌ 未登录**
   - 解决方法：点击右上角"登出"，然后重新登录

2. **❌ 网络错误：无法连接到后端服务**
   - 解决方法：
     - 打开终端
     - 进入 `智鸽系统_副本/backend` 目录
     - 运行 `npm start`
     - 等待看到 "服务器运行在 http://localhost:3000"

3. **❌ 认证失败**
   - 解决方法：重新登录

4. **❌ API返回错误**
   - 解决方法：点击 **"🔄 刷新信息"** 按钮重试

#### 步骤4：手动刷新
如果信息没有显示：
1. 点击 **"🔄 刷新信息"** 按钮
2. 查看错误信息框中的提示

#### 步骤5：测试连接
1. 点击 **"🧪 测试连接"** 按钮
2. 查看测试结果

---

## 📋 问题：助手回答很人机

### ✅ 已完成的修复

1. **Token获取**：已修复，现在会正确获取`adminToken`
2. **API调用**：已优化，优先使用AI API
3. **错误提示**：失败时会显示明确的错误信息

### 🔍 排查步骤

#### 步骤1：测试助手
1. 点击右下角的 **Evo助手** 图标
2. 发送消息："你好"
3. 查看回复：
   - ✅ **AI回复**：回复自然、有上下文理解
   - ❌ **本地逻辑**：回复像"我理解您的问题..."这样的模板

#### 步骤2：检查后端服务
如果助手回复很人机，可能是后端AI服务没有正常工作：

1. **检查后端服务是否运行**
   - 打开终端
   - 进入 `智鸽系统_副本/backend` 目录
   - 运行 `npm start`
   - 确认看到 "服务器运行在 http://localhost:3000"

2. **检查API Key配置**
   - 打开 `智鸽系统_副本/backend/.env` 文件
   - 确认有 `ZHIPU_API_KEY=...` 这一行
   - 确认API Key格式正确

3. **测试API连接**
   - 在Evo设置页面点击 **"🧪 测试连接"** 按钮
   - 查看测试结果

---

## 🛠️ 快速诊断命令

### 检查后端服务
```bash
cd "智鸽系统_副本/backend"
curl http://localhost:3000/api/health
```

应该返回：`{"success":true,"status":"healthy",...}`

### 检查API Key
```bash
cd "智鸽系统_副本/backend"
grep ZHIPU_API_KEY .env
```

应该显示：`ZHIPU_API_KEY=d5122a7786c843eb89dc6a54a205013b.wk0PpzZjfjitzECr`

### 测试AI服务
```bash
cd "智鸽系统_副本/backend"
node test-ai.js
```

---

## 📞 如果问题仍然存在

请提供以下信息：

1. **Evo设置页面显示的错误信息**（截图或文字）
2. **助手回复的内容**（截图或文字）
3. **后端服务是否运行**（运行 `npm start` 后看到什么）
4. **API Key是否存在**（运行 `grep ZHIPU_API_KEY .env` 的结果）

---

## ✅ 正常状态示例

### AI模型信息正常显示：
- 模型名称：智谱AI (GLM)
- 服务提供商：ZhipuAI
- 使用状态：✅ 免费使用
- 模型描述：智能对话模型，支持中文对话
- 功能特性：• 完全免费使用 • 支持中文对话 • 高性能响应

### 助手正常回复：
- 回复自然、有上下文理解
- 不是模板化的"我理解您的问题..."
- 能够理解用户意图并给出相关回答































