# Zeabur 部署配置说明

## 📋 部署前准备

### 1. 环境变量配置

在 Zeabur 项目设置中，添加以下环境变量：

#### 必需的环境变量

```
ZHIPU_API_KEY_EVO=你的智谱API密钥（Evo助手使用）
```

或

```
ZHIPU_API_KEY_ADMIN=你的智谱API密钥（中枢管家使用）
```

或

```
ZHIPU_API_KEY=你的智谱API密钥（通用）
```

**注意：** 至少需要配置其中一个。系统会按以下优先级读取：
1. `ZHIPU_API_KEY_EVO`
2. `ZHIPU_API_KEY_ADMIN`
3. `ZHIPU_API_KEY`

#### 其他可选环境变量

```
NODE_ENV=production
PORT=3000（Zeabur会自动设置，无需手动配置）
```

### 2. 项目根目录设置

在 Zeabur 项目设置中：
- **根目录（Root Directory）**: 留空或设置为 `/`（使用项目根目录）
- **构建命令（Build Command）**: 留空（无需构建）
- **启动命令（Start Command）**: `npm start` 或 `cd backend && node server.js`

### 3. 端口配置

Zeabur 会自动设置 `PORT` 环境变量，代码已自动适配，无需手动配置。

## 🚀 部署步骤

### 步骤1：推送代码到 GitHub

确保所有代码已推送到 GitHub 仓库：

```bash
git add .
git commit -m "修复移动端交互和智谱API调用问题"
git push origin main
```

### 步骤2：在 Zeabur 中配置项目

1. 登录 Zeabur 控制台
2. 选择或创建项目
3. 连接 GitHub 仓库
4. 选择正确的分支（通常是 `main`）

### 步骤3：配置环境变量

1. 进入项目设置
2. 找到 "Environment Variables" 或 "环境变量" 选项
3. 添加 `ZHIPU_API_KEY_EVO` 或 `ZHIPU_API_KEY_ADMIN`
4. 输入你的智谱API密钥
5. 保存配置

### 步骤4：配置启动命令

1. 在项目设置中找到 "Start Command" 或 "启动命令"
2. 设置为：`npm start`
3. 或直接设置为：`cd backend && node server.js`

### 步骤5：部署

1. 点击 "Deploy" 或 "部署" 按钮
2. 等待部署完成（通常需要 1-3 分钟）
3. 查看部署日志，确认没有错误

## ✅ 部署验证

### 1. 检查服务状态

部署完成后，在 Zeabur 控制台查看：
- ✅ 服务状态显示为 "Running" 或 "运行中"
- ✅ 没有红色错误提示
- ✅ 日志中显示 "服务器已启动" 或类似信息

### 2. 测试移动端访问

1. 使用手机浏览器访问部署后的网站
2. 检查以下功能：
   - ✅ 页面可以正常加载
   - ✅ 所有按钮可以点击
   - ✅ 输入框可以正常输入
   - ✅ 底部导航栏可以切换视图
   - ✅ Evo助手可以正常对话

### 3. 测试智谱API调用

1. 打开移动端页面
2. 点击 Evo 助手图标
3. 发送一条测试消息（如："你好"）
4. 检查是否收到AI回复

**如果API调用失败，检查：**
- 环境变量是否正确配置
- API密钥是否有效
- 查看浏览器控制台（使用vConsole）是否有错误信息
- 查看Zeabur部署日志是否有错误

### 4. 使用vConsole调试

移动端已集成 vConsole 调试工具：
1. 打开移动端页面
2. 在页面右下角找到 vConsole 图标
3. 点击打开调试面板
4. 查看 Console 标签页的错误信息

## 🔧 常见问题排查

### 问题1：移动端按钮无法点击

**可能原因：**
- 浏览器缓存未清除
- CSS样式冲突
- JavaScript未正确加载

**解决方法：**
1. 清除浏览器缓存（强制刷新：Ctrl+F5 或 Cmd+Shift+R）
2. 检查浏览器控制台是否有JavaScript错误
3. 确认 FastClick 和修复脚本已加载（查看控制台日志）

### 问题2：智谱API调用失败

**可能原因：**
- 环境变量未配置
- API密钥无效
- 代理服务未启动

**解决方法：**
1. 检查 Zeabur 环境变量配置
2. 验证 API 密钥是否正确
3. 查看后端日志，确认代理服务是否正常
4. 测试代理接口：访问 `https://你的域名/api/proxy/chat`（应该返回错误，但不应是404）

### 问题3：页面加载缓慢

**可能原因：**
- 资源文件过大
- 网络连接问题
- 服务器响应慢

**解决方法：**
1. 检查网络连接
2. 查看 Zeabur 服务器资源使用情况
3. 考虑启用 CDN 加速

### 问题4：部署后功能异常

**可能原因：**
- 代码未正确推送
- 环境变量配置错误
- 依赖包未安装

**解决方法：**
1. 确认代码已推送到 GitHub
2. 检查 Zeabur 部署日志
3. 重新部署项目

## 📝 部署检查清单

部署前确认：

- [ ] 代码已推送到 GitHub
- [ ] 环境变量已配置（ZHIPU_API_KEY_EVO 或 ZHIPU_API_KEY_ADMIN）
- [ ] 启动命令已设置（npm start）
- [ ] 根目录设置正确
- [ ] package.json 中包含所有必需依赖

部署后验证：

- [ ] 服务状态为 "Running"
- [ ] 移动端页面可以正常访问
- [ ] 所有按钮可以点击
- [ ] Evo助手可以正常对话
- [ ] 没有控制台错误
- [ ] 数据可以正常保存和加载

## 🎯 快速部署命令

如果使用 Zeabur CLI：

```bash
# 安装 Zeabur CLI
npm install -g @zeabur/cli

# 登录
zeabur login

# 部署
zeabur deploy
```

## 📞 技术支持

如果遇到问题：

1. 查看 Zeabur 部署日志
2. 使用 vConsole 查看移动端错误
3. 检查浏览器控制台（PC端）
4. 验证环境变量配置
5. 确认 API 密钥有效性

---

**最后更新：** 2025-12-24
**版本：** 1.0.0

