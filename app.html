<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºé¸½ï½œPigeonAI - æ­£åœ¨åŠ è½½...</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: #fff;
    }
    
    .loading-container {
      text-align: center;
      padding: 40px;
    }
    
    .logo {
      font-size: 64px;
      margin-bottom: 20px;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    h1 {
      font-size: 28px;
      margin-bottom: 12px;
      font-weight: 700;
    }
    
    p {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 8px;
    }
    
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #fff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 30px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .device-info {
      margin-top: 30px;
      font-size: 14px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="loading-container">
    <div class="logo">ğŸ•Šï¸</div>
    <h1>æ™ºé¸½ï½œPigeonAI</h1>
    <p>æ­£åœ¨æ£€æµ‹æ‚¨çš„è®¾å¤‡...</p>
    <div class="spinner"></div>
    <div class="device-info" id="deviceInfo"></div>
  </div>

  <script>
    // è®¾å¤‡æ£€æµ‹å‡½æ•°
    function detectDevice() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      const width = window.innerWidth || document.documentElement.clientWidth;
      
      // ç§»åŠ¨è®¾å¤‡æ£€æµ‹
      const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent.toLowerCase());
      
      // å¹³æ¿æ£€æµ‹ï¼ˆé€šå¸¸å±å¹•å®½åº¦åœ¨ 768px - 1024px ä¹‹é—´ï¼‰
      const isTablet = width >= 768 && width <= 1024 && isMobile;
      
      // å°å±å¹•ç§»åŠ¨è®¾å¤‡ï¼ˆé€šå¸¸å°äº 768pxï¼‰
      const isSmallMobile = width < 768 && isMobile;
      
      // æ ¹æ®å±å¹•å®½åº¦å’ŒUser-Agentåˆ¤æ–­
      let deviceType = 'desktop';
      let targetPage = 'index.html';
      
      if (isSmallMobile || (isMobile && width < 768)) {
        deviceType = 'mobile';
        targetPage = 'mobile.html';
      } else if (isTablet || (isMobile && width >= 768)) {
        // å¹³æ¿å¯ä»¥é€‰æ‹©ç§»åŠ¨ç«¯æˆ–PCç«¯ï¼Œè¿™é‡Œé»˜è®¤ç§»åŠ¨ç«¯ï¼ˆå› ä¸ºè§¦æ‘¸æ“ä½œæ›´å‹å¥½ï¼‰
        deviceType = 'tablet';
        targetPage = 'mobile.html';
      } else {
        deviceType = 'desktop';
        targetPage = 'index.html';
      }
      
      return {
        type: deviceType,
        page: targetPage,
        userAgent: userAgent,
        width: width,
        height: window.innerHeight || document.documentElement.clientHeight
      };
    }
    
    // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
    function showDeviceInfo(device) {
      const deviceInfoEl = document.getElementById('deviceInfo');
      const typeNames = {
        'mobile': 'ç§»åŠ¨è®¾å¤‡',
        'tablet': 'å¹³æ¿è®¾å¤‡',
        'desktop': 'æ¡Œé¢è®¾å¤‡'
      };
      
      deviceInfoEl.innerHTML = `
        <div>è®¾å¤‡ç±»å‹: ${typeNames[device.type] || device.type}</div>
        <div>å±å¹•å°ºå¯¸: ${device.width} Ã— ${device.height}px</div>
        <div>å³å°†è·³è½¬åˆ°: ${device.page}</div>
      `;
    }
    
    // æ£€æŸ¥ç™»å½•çŠ¶æ€å¹¶æ¢å¤æ•°æ®
    async function checkLoginAndRestore() {
      try {
        // æ£€æŸ¥æ˜¯å¦æœ‰token
        const token = localStorage.getItem('token') || localStorage.getItem('auth_token');
        if (!token) {
          return null; // æœªç™»å½•ï¼Œæ— éœ€æ¢å¤
        }
        
        // è·å–APIé…ç½®
        const apiConfig = JSON.parse(localStorage.getItem('pigeon_api_config') || '{}');
        const apiUrl = apiConfig.apiUrl || 'http://localhost:3000/api';
        
        // å°è¯•è·å–ç”¨æˆ·æ•°æ®
        const response = await fetch(`${apiUrl}/user/data/full`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          const result = await response.json();
          if (result.success && result.data) {
            return result.data; // è¿”å›ç”¨æˆ·æ•°æ®
          }
        }
      } catch (error) {
        console.warn('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
      }
      
      return null;
    }
    
    // ä¿å­˜è®¾å¤‡ä¿¡æ¯åˆ°localStorageï¼ˆç”¨äºè·¨è®¾å¤‡è¯†åˆ«ï¼‰
    function saveDeviceInfo(device) {
      const deviceInfo = {
        type: device.type,
        userAgent: device.userAgent,
        width: device.width,
        height: device.height,
        timestamp: new Date().toISOString()
      };
      
      localStorage.setItem('pigeon_device_info', JSON.stringify(deviceInfo));
      
      // å¦‚æœæœ‰è®¾å¤‡IDï¼Œä¹Ÿä¿å­˜
      let deviceId = localStorage.getItem('pigeon_device_id');
      if (!deviceId) {
        deviceId = 'dev_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('pigeon_device_id', deviceId);
      }
    }
    
    // ä¸»å‡½æ•°
    async function init() {
      // æ£€æµ‹è®¾å¤‡
      const device = detectDevice();
      showDeviceInfo(device);
      
      // ä¿å­˜è®¾å¤‡ä¿¡æ¯
      saveDeviceInfo(device);
      
      // æ£€æŸ¥ç™»å½•çŠ¶æ€å¹¶æ¢å¤æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
      const userData = await checkLoginAndRestore();
      
      // å»¶è¿Ÿä¸€ä¸‹è®©ç”¨æˆ·çœ‹åˆ°è®¾å¤‡ä¿¡æ¯ï¼Œç„¶åè·³è½¬
      setTimeout(() => {
        // å¦‚æœæ£€æµ‹åˆ°ç”¨æˆ·æ•°æ®ï¼Œå¯ä»¥åœ¨URLä¸­ä¼ é€’æ ‡è®°
        const params = new URLSearchParams();
        if (userData) {
          params.set('restored', 'true');
        }
        params.set('device', device.type);
        
        const targetUrl = device.page + (params.toString() ? '?' + params.toString() : '');
        window.location.href = targetUrl;
      }, 1500); // 1.5ç§’åè·³è½¬
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>










