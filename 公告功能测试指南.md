# 公告功能测试指南

## 测试步骤

### 1. 在后台管理系统发布公告

1. **登录后台管理系统**
   - 打开 `admin.html`
   - 使用管理员账户登录（默认：`admin` / `admin123`）

2. **进入公告管理页面**
   - 在左侧菜单中点击"公告管理"
   - 页面会显示现有的公告列表

3. **发布新公告**
   - 点击"➕ 发布新公告"按钮
   - 在弹出的对话框中输入公告内容
   - **重要**：确保勾选"立即发布"复选框（这样公告才会显示在主站）
   - 点击"保存"按钮

4. **验证公告已保存**
   - 在公告列表中应该能看到新发布的公告
   - 状态应该显示为"✓ 已发布"

### 2. 在主站查看公告

1. **打开主站**
   - 打开 `index.html`
   - 确保已切换到"首页"视图

2. **查看公告栏**
   - 在主页顶部，找到"晴朗"天气信息
   - 在"晴朗"和"今日资讯"之间应该能看到公告栏（📢 图标）
   - 公告栏应该显示最新发布的公告内容

3. **验证公告显示**
   - 公告栏应该显示完整的公告文本（如果文本过长会自动截断）
   - 公告栏的样式应该与天气和统计项的气泡样式一致

### 3. 测试场景

#### 场景1：发布新公告
- ✅ 在后台发布一条新公告（勾选"立即发布"）
- ✅ 刷新主站首页，检查公告栏是否显示新公告

#### 场景2：编辑公告
- ✅ 在后台编辑一条已发布的公告
- ✅ 刷新主站首页，检查公告栏是否显示更新后的内容

#### 场景3：发布多条公告
- ✅ 在后台发布多条公告（都勾选"立即发布"）
- ✅ 刷新主站首页，检查公告栏是否显示最新的公告（按更新时间排序）

#### 场景4：草稿公告
- ✅ 在后台创建一条公告但不勾选"立即发布"（保存为草稿）
- ✅ 刷新主站首页，检查公告栏是否不显示草稿公告

#### 场景5：删除公告
- ✅ 在后台删除一条已发布的公告
- ✅ 刷新主站首页，检查公告栏是否不再显示该公告

## 常见问题排查

### 问题1：公告栏显示"暂无公告"

**可能原因：**
- 没有已发布的公告（所有公告都是草稿状态）
- API端点不正确
- 后端服务未启动

**解决方法：**
1. 检查后台是否有已发布的公告（状态为"✓ 已发布"）
2. 检查浏览器控制台是否有错误信息
3. 确认后端服务是否正常运行（`http://localhost:3000`）
4. 检查API配置是否正确

### 问题2：公告栏不显示

**可能原因：**
- 公告栏元素未正确加载
- CSS样式问题

**解决方法：**
1. 检查浏览器开发者工具，确认 `homeAnnouncementBubble` 元素是否存在
2. 检查控制台是否有JavaScript错误
3. 确认主页是否正确初始化

### 问题3：公告内容过长显示不完整

**这是正常行为：**
- 公告栏有最大宽度限制（300px）
- 文本过长会自动截断并显示省略号（...）
- 这是为了保持页面布局的一致性

## API端点说明

### 后台管理系统
- **获取公告列表**：`GET /api/admin/announcements`（需要管理员token）
- **创建公告**：`POST /api/admin/announcements`（需要管理员token）
- **更新公告**：`PUT /api/admin/announcements/:id`（需要管理员token）
- **删除公告**：`DELETE /api/admin/announcements/:id`（需要管理员token）

### 主站
- **获取公共公告**：`GET /api/announcements/public`（不需要token）

## 注意事项

1. **公告状态**：只有状态为"已发布"（`active: true`）的公告才会在主站显示
2. **公告排序**：主站会显示最新的已发布公告（按更新时间排序）
3. **自动刷新**：保存公告后，如果当前在首页，公告栏会自动刷新
4. **API配置**：确保API地址配置正确（默认：`http://localhost:3000/api`）

## 测试检查清单

- [ ] 可以在后台发布新公告
- [ ] 可以在后台编辑公告
- [ ] 可以在后台删除公告
- [ ] 草稿公告不在主站显示
- [ ] 已发布公告在主站正确显示
- [ ] 主站显示的是最新的已发布公告
- [ ] 公告栏样式与天气和统计项一致
- [ ] 保存公告后，如果当前在首页，公告栏自动刷新
- [ ] 长文本自动截断显示
- [ ] 无公告时显示"暂无公告"



