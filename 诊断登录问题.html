<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç™»å½•é—®é¢˜è¯Šæ–­å·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .diagnostic-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    h1 {
      color: #333;
    }
    .test-btn {
      padding: 10px 20px;
      margin: 5px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .test-btn:hover {
      background: #1d4ed8;
    }
    .result {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 12px;
    }
    .success {
      background: #d1fae5;
      color: #065f46;
    }
    .error {
      background: #fee2e2;
      color: #991b1b;
    }
    .info {
      background: #dbeafe;
      color: #1e40af;
    }
  </style>
</head>
<body>
  <div class="diagnostic-card">
    <h1>ğŸ”§ ç™»å½•é—®é¢˜è¯Šæ–­å·¥å…·</h1>
    <p>è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©è¯Šæ–­admin.htmlçš„ç™»å½•å’Œå¯†ç æ˜¾ç¤ºé—®é¢˜ã€‚</p>
    
    <button class="test-btn" onclick="testPasswordToggle()">æµ‹è¯•å¯†ç æ˜¾ç¤ºåŠŸèƒ½</button>
    <button class="test-btn" onclick="testLoginFunction()">æµ‹è¯•ç™»å½•åŠŸèƒ½</button>
    <button class="test-btn" onclick="checkAdminHTML()">æ£€æŸ¥admin.htmlæ–‡ä»¶</button>
    <button class="test-btn" onclick="clearCache()">æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</button>
    
    <div id="diagnosticResult"></div>
  </div>

  <script>
    function testPasswordToggle() {
      const result = document.getElementById('diagnosticResult');
      result.innerHTML = '<div class="result info">æ­£åœ¨æµ‹è¯•å¯†ç æ˜¾ç¤ºåŠŸèƒ½...</div>';
      
      // æ£€æŸ¥å‡½æ•°æ˜¯å¦å®šä¹‰
      if (typeof window.togglePasswordVisibility === 'function') {
        result.innerHTML = '<div class="result success">âœ… togglePasswordVisibility å‡½æ•°å·²å®šä¹‰\n\nç°åœ¨è¯·ï¼š\n1. æ‰“å¼€admin.html\n2. åœ¨å¯†ç è¾“å…¥æ¡†å³ä¾§ç‚¹å‡»çœ¼ç›å›¾æ ‡\n3. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰"ğŸ”„ togglePasswordVisibility è¢«è°ƒç”¨"çš„æ—¥å¿—</div>';
      } else {
        result.innerHTML = '<div class="result error">âŒ togglePasswordVisibility å‡½æ•°æœªå®šä¹‰\n\né—®é¢˜ï¼šå‡½æ•°å¯èƒ½æœªæ­£ç¡®åŠ è½½\nè§£å†³æ–¹æ¡ˆï¼š\n1. æ£€æŸ¥admin.htmlçš„headä¸­æ˜¯å¦æœ‰å‡½æ•°å®šä¹‰\n2. åˆ·æ–°é¡µé¢ï¼ˆCmd+Shift+Rï¼‰\n3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯</div>';
      }
    }
    
    function testLoginFunction() {
      const result = document.getElementById('diagnosticResult');
      result.innerHTML = '<div class="result info">æ­£åœ¨æµ‹è¯•ç™»å½•åŠŸèƒ½...</div>';
      
      // æ£€æŸ¥localStorage
      const token = localStorage.getItem('adminToken');
      const user = localStorage.getItem('adminUser');
      
      let message = 'ç™»å½•åŠŸèƒ½æµ‹è¯•ç»“æœï¼š\n\n';
      
      if (token && user) {
        message += 'âœ… æ£€æµ‹åˆ°å·²ä¿å­˜çš„ç™»å½•ä¿¡æ¯\n';
        message += `Token: ${token.substring(0, 20)}...\n`;
        try {
          const userData = JSON.parse(user);
          message += `ç”¨æˆ·: ${userData.username}\n`;
          message += `è§’è‰²: ${userData.role}\n\n`;
        } catch (e) {
          message += `ç”¨æˆ·æ•°æ®è§£æå¤±è´¥: ${e.message}\n\n`;
        }
      } else {
        message += 'â„¹ï¸ æœªæ£€æµ‹åˆ°å·²ä¿å­˜çš„ç™»å½•ä¿¡æ¯\n\n';
      }
      
      message += 'æµ‹è¯•æ­¥éª¤ï¼š\n';
      message += '1. æ‰“å¼€admin.html\n';
      message += '2. è¾“å…¥ç”¨æˆ·åï¼šadmin\n';
      message += '3. è¾“å…¥å¯†ç ï¼šadmin123\n';
      message += '4. å‹¾é€‰"ä½¿ç”¨æœ¬åœ°éªŒè¯"\n';
      message += '5. ç‚¹å‡»"ç™»å½•"æŒ‰é’®\n';
      message += '6. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„æ—¥å¿—\n\n';
      message += 'é¢„æœŸæ—¥å¿—ï¼š\n';
      message += '- "ğŸ”§ ä½¿ç”¨æœ¬åœ°éªŒè¯æ¨¡å¼"\n';
      message += '- "ğŸ” éªŒè¯è¯¦æƒ…: ..."\n';
      message += '- "âœ… æœ¬åœ°éªŒè¯æˆåŠŸ"\n';
      message += '- "âœ… ç™»å½•æˆåŠŸï¼Œå·²åˆ‡æ¢åˆ°ç®¡ç†é¡µé¢"';
      
      result.innerHTML = `<div class="result info">${message}</div>`;
    }
    
    function checkAdminHTML() {
      const result = document.getElementById('diagnosticResult');
      result.innerHTML = '<div class="result info">æ­£åœ¨æ£€æŸ¥admin.htmlæ–‡ä»¶...</div>';
      
      // å°è¯•è¯»å–admin.html
      fetch('admin.html')
        .then(response => {
          if (response.ok) {
            return response.text();
          }
          throw new Error('æ— æ³•è¯»å–admin.htmlæ–‡ä»¶');
        })
        .then(html => {
          // æ£€æŸ¥å…³é”®å…ƒç´ 
          const checks = [];
          
          // æ£€æŸ¥togglePasswordVisibilityå‡½æ•°
          if (html.includes('window.togglePasswordVisibility') || html.includes('function togglePasswordVisibility')) {
            checks.push('âœ… togglePasswordVisibility å‡½æ•°å·²å®šä¹‰');
          } else {
            checks.push('âŒ togglePasswordVisibility å‡½æ•°æœªæ‰¾åˆ°');
          }
          
          // æ£€æŸ¥onclickå±æ€§
          if (html.includes('onclick="togglePasswordVisibility()"')) {
            checks.push('âœ… å¯†ç æ˜¾ç¤ºæŒ‰é’®æœ‰onclickå±æ€§');
          } else {
            checks.push('âŒ å¯†ç æ˜¾ç¤ºæŒ‰é’®ç¼ºå°‘onclickå±æ€§');
          }
          
          // æ£€æŸ¥ç™»å½•è¡¨å•
          if (html.includes('id="loginForm"')) {
            checks.push('âœ… ç™»å½•è¡¨å•å­˜åœ¨');
          } else {
            checks.push('âŒ ç™»å½•è¡¨å•æœªæ‰¾åˆ°');
          }
          
          // æ£€æŸ¥handleLoginSubmitå‡½æ•°
          if (html.includes('handleLoginSubmit') || html.includes('function handleLoginSubmit')) {
            checks.push('âœ… handleLoginSubmit å‡½æ•°å·²å®šä¹‰');
          } else {
            checks.push('âŒ handleLoginSubmit å‡½æ•°æœªæ‰¾åˆ°');
          }
          
          // æ£€æŸ¥æœ¬åœ°éªŒè¯é€»è¾‘
          if (html.includes('useLocalAuth') && html.includes('admin123')) {
            checks.push('âœ… æœ¬åœ°éªŒè¯é€»è¾‘å­˜åœ¨');
          } else {
            checks.push('âŒ æœ¬åœ°éªŒè¯é€»è¾‘å¯èƒ½æœ‰é—®é¢˜');
          }
          
          result.innerHTML = `<div class="result ${checks.some(c => c.includes('âŒ')) ? 'error' : 'success'}">æ£€æŸ¥ç»“æœï¼š\n\n${checks.join('\n')}</div>`;
        })
        .catch(error => {
          result.innerHTML = `<div class="result error">âŒ æ— æ³•è¯»å–admin.htmlæ–‡ä»¶\n\né”™è¯¯ï¼š${error.message}\n\nè¯·ç¡®ä¿ï¼š\n1. admin.htmlæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹\n2. ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨æ‰“å¼€ï¼ˆä¸æ˜¯ç›´æ¥æ‰“å¼€æ–‡ä»¶ï¼‰</div>`;
        });
    }
    
    function clearCache() {
      const result = document.getElementById('diagnosticResult');
      result.innerHTML = '<div class="result info">æ¸…é™¤ç¼“å­˜è¯´æ˜ï¼š\n\nSafariæµè§ˆå™¨ï¼š\n1. Safari â†’ åå¥½è®¾ç½®\n2. é«˜çº§ â†’ å‹¾é€‰"åœ¨èœå•æ ä¸­æ˜¾ç¤ºå¼€å‘èœå•"\n3. å¼€å‘ â†’ æ¸…ç©ºç¼“å­˜\n\næˆ–è€…ï¼š\n1. æŒ‰ Cmd+Shift+R ç¡¬åˆ·æ–°é¡µé¢\n2. å®Œå…¨å…³é—­Safariï¼ˆCmd+Qï¼‰åé‡æ–°æ‰“å¼€</div>';
    }
  </script>
</body>
</html>

























