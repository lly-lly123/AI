# ğŸš¨ ç§»åŠ¨ç«¯é¡µé¢ç©ºç™½é—®é¢˜ç´§æ€¥ä¿®å¤æŠ¥å‘Š

## ğŸ” å‘ç°çš„é—®é¢˜

### é—®é¢˜1ï¼šErudaåˆå§‹åŒ–é˜»å¡é¡µé¢æ¸²æŸ“
- **é—®é¢˜**ï¼šErudaè„šæœ¬åœ¨ `<head>` ä¸­åŒæ­¥åŠ è½½ï¼Œå¯èƒ½å¯¼è‡´é¡µé¢æ¸²æŸ“é˜»å¡
- **å½±å“**ï¼šé¡µé¢å¯èƒ½æ˜¾ç¤ºä¸ºç©ºç™½
- **ä¿®å¤**ï¼šâœ… æ”¹ä¸ºå»¶è¿ŸåŠ¨æ€åŠ è½½Erudaï¼Œç¡®ä¿ä¸å½±å“é¡µé¢æ¸²æŸ“

### é—®é¢˜2ï¼šgetApiConfigå‡½æ•°åœ¨éƒ¨ç½²ç¯å¢ƒä¸­ä½¿ç”¨localhost
- **é—®é¢˜**ï¼š`getApiConfig()` å‡½æ•°é»˜è®¤è¿”å› `http://localhost:3000/api`ï¼Œåœ¨éƒ¨ç½²ç¯å¢ƒä¸­é”™è¯¯
- **å½±å“**ï¼šè‡ªåŠ¨ç™»å½•è„šæœ¬ä½¿ç”¨é”™è¯¯çš„API URLï¼Œå¯¼è‡´æ³¨å†Œå¤±è´¥
- **ä¿®å¤**ï¼šâœ… è‡ªåŠ¨æ£€æµ‹éƒ¨ç½²ç¯å¢ƒï¼Œåœ¨élocalhostç¯å¢ƒä¸‹ä½¿ç”¨å½“å‰åŸŸå

### é—®é¢˜3ï¼šReferenceError: Can't find variable: apiUrl
- **é—®é¢˜**ï¼šæŸä¸ªåœ°æ–¹ä½¿ç”¨äº†æœªå®šä¹‰çš„ `apiUrl` å˜é‡
- **å½±å“**ï¼šå¯¼è‡´JavaScripté”™è¯¯ï¼Œé¡µé¢æ— æ³•æ­£å¸¸æ¸²æŸ“
- **ä¿®å¤**ï¼šâœ… ä¿®å¤ `getApiConfig()` å‡½æ•°ï¼Œç¡®ä¿æ‰€æœ‰åœ°æ–¹éƒ½èƒ½æ­£ç¡®è·å–API URL

## âœ… å·²å®æ–½çš„ä¿®å¤

### 1. ä¿®å¤Erudaåˆå§‹åŒ–ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰
```javascript
// å»¶è¿ŸåŠ è½½Erudaï¼Œç¡®ä¿ä¸å½±å“é¡µé¢æ¸²æŸ“
(function() {
  function loadEruda() {
    // åªåœ¨ç§»åŠ¨è®¾å¤‡ä¸ŠåŠ è½½
    if (!/Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
      return;
    }
    
    // åŠ¨æ€åŠ è½½Erudaè„šæœ¬
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/eruda';
    script.onload = function() {
      // ç¡®ä¿bodyå­˜åœ¨åå†åˆå§‹åŒ–
      function initEruda() {
        if (document.body && typeof eruda !== 'undefined') {
          try {
            eruda.init({
              container: document.body,
              tool: ['console', 'elements', 'network', 'resources', 'info', 'snippets'],
              autoScale: true,
              defaults: {
                displaySize: 50,
                transparency: 0.9,
                theme: 'dark'
              }
            });
            console.log('âœ… Erudaè°ƒè¯•å·¥å…·å·²åˆå§‹åŒ–ï¼ˆä¸­æ–‡ç‰ˆï¼‰');
          } catch (e) {
            console.warn('âš ï¸ Erudaåˆå§‹åŒ–å¤±è´¥:', e);
          }
        } else {
          setTimeout(initEruda, 100);
        }
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initEruda);
      } else {
        setTimeout(initEruda, 100);
      }
    };
    script.onerror = function() {
      console.warn('âš ï¸ Erudaè„šæœ¬åŠ è½½å¤±è´¥');
    };
    document.head.appendChild(script);
  }
  
  // å»¶è¿ŸåŠ è½½ï¼Œç¡®ä¿ä¸å½±å“é¡µé¢æ¸²æŸ“
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadEruda);
  } else {
    setTimeout(loadEruda, 500);
  }
})();
```
**ä½ç½®**ï¼š`mobile.html` ç¬¬ 11-44 è¡Œ
**æ”¹è¿›**ï¼š
- âœ… å»¶è¿Ÿ500msåŠ è½½ï¼Œç¡®ä¿é¡µé¢å…ˆæ¸²æŸ“
- âœ… åŠ¨æ€åˆ›å»ºscriptæ ‡ç­¾ï¼Œä¸é˜»å¡é¡µé¢
- âœ… ç¡®ä¿bodyå­˜åœ¨åå†åˆå§‹åŒ–
- âœ… æ·»åŠ é”™è¯¯å¤„ç†

### 2. ä¿®å¤getApiConfigå‡½æ•°ï¼ˆè‡ªåŠ¨æ£€æµ‹éƒ¨ç½²ç¯å¢ƒï¼‰
```javascript
// è·å–APIé…ç½®ï¼ˆè‡ªåŠ¨æ£€æµ‹éƒ¨ç½²ç¯å¢ƒï¼‰
function getApiConfig() {
  // è‡ªåŠ¨æ£€æµ‹å½“å‰ç¯å¢ƒ
  const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
  const defaultBaseUrl = isLocalhost ? 'http://localhost:3000/api' : (window.location.origin + '/api');
  
  const config = localStorage.getItem('pigeon_api_config');
  if (config) {
    try {
      const parsed = JSON.parse(config);
      // å¦‚æœé…ç½®çš„URLåŒ…å«localhostï¼Œä½†åœ¨éƒ¨ç½²ç¯å¢ƒä¸­ï¼Œè‡ªåŠ¨æ›´æ–°
      if (!isLocalhost && parsed.apiUrl && parsed.apiUrl.includes('localhost')) {
        parsed.apiUrl = defaultBaseUrl;
        // æ›´æ–°é…ç½®
        localStorage.setItem('pigeon_api_config', JSON.stringify(parsed));
      }
      if (!parsed.apiUrl) {
        parsed.apiUrl = defaultBaseUrl;
      }
      return parsed;
    } catch (e) {
      console.warn('è§£æAPIé…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼:', e);
    }
  }
  
  return {
    apiUrl: defaultBaseUrl,
    newsApiUrl: defaultBaseUrl + '/news',
    eventsApiUrl: defaultBaseUrl + '/events',
    apiKey: ''
  };
}
```
**ä½ç½®**ï¼š`mobile.html` ç¬¬ 2688-2715 è¡Œ
**æ”¹è¿›**ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹æ˜¯å¦ä¸ºlocalhostç¯å¢ƒ
- âœ… åœ¨éƒ¨ç½²ç¯å¢ƒä¸­è‡ªåŠ¨ä½¿ç”¨å½“å‰åŸŸå
- âœ… è‡ªåŠ¨æ›´æ–°localStorageä¸­è¿‡æœŸçš„localhosté…ç½®
- âœ… æ·»åŠ é”™è¯¯å¤„ç†

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- âŒ é¡µé¢æ˜¾ç¤ºä¸ºç©ºç™½
- âŒ Erudaè°ƒè¯•å·¥å…·æ— æ³•æ˜¾ç¤º
- âŒ è‡ªåŠ¨ç™»å½•ä½¿ç”¨é”™è¯¯çš„localhost URL
- âŒ `ReferenceError: Can't find variable: apiUrl` é”™è¯¯

### ä¿®å¤å
- âœ… é¡µé¢æ­£å¸¸æ¸²æŸ“
- âœ… Erudaè°ƒè¯•å·¥å…·å»¶è¿ŸåŠ è½½ï¼Œä¸å½±å“é¡µé¢
- âœ… è‡ªåŠ¨ç™»å½•ä½¿ç”¨æ­£ç¡®çš„éƒ¨ç½²ç¯å¢ƒURL
- âœ… æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨æ­£ç¡®çš„URL

## ğŸ”§ éªŒè¯æ­¥éª¤

### 1. éªŒè¯é¡µé¢æ¸²æŸ“
1. åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ‰“å¼€é¡µé¢
2. é¡µé¢åº”è¯¥ç«‹å³æ˜¾ç¤ºå†…å®¹ï¼ˆä¸å†æ˜¯ç©ºç™½ï¼‰
3. æ£€æŸ¥æ˜¯å¦æœ‰JavaScripté”™è¯¯

### 2. éªŒè¯Erudaè°ƒè¯•å·¥å…·
1. ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
2. ç­‰å¾…çº¦1-2ç§’ï¼ŒErudaå›¾æ ‡åº”è¯¥å‡ºç°åœ¨å³ä¸‹è§’
3. ç‚¹å‡»å›¾æ ‡ï¼Œåº”è¯¥èƒ½çœ‹åˆ°è°ƒè¯•é¢æ¿

### 3. éªŒè¯è‡ªåŠ¨ç™»å½•
1. æ‰“å¼€Eruda Consoleæ ‡ç­¾é¡µ
2. åº”è¯¥èƒ½çœ‹åˆ°è‡ªåŠ¨ç™»å½•çš„æ—¥å¿—ï¼š
   ```
   ğŸ”§ [è‡ªåŠ¨è´¦å·] å¼€å§‹åˆå§‹åŒ–è‡ªåŠ¨è´¦å·æ³¨å†Œç³»ç»Ÿ...
   âœ… [è‡ªåŠ¨è´¦å·] å·²åˆ›å»ºæ–°è®¾å¤‡ID: ...
   ğŸ”§ [è‡ªåŠ¨è´¦å·] æ­£åœ¨è‡ªåŠ¨æ³¨å†Œè´¦å·...
   âœ… [è‡ªåŠ¨è´¦å·] è´¦å·æ³¨å†ŒæˆåŠŸ: user_...
   ```
3. æ£€æŸ¥æ³¨å†ŒURLï¼Œåº”è¯¥æ˜¯éƒ¨ç½²ç¯å¢ƒçš„URLï¼Œè€Œä¸æ˜¯localhost

### 4. éªŒè¯APIè°ƒç”¨
1. æ‰“å¼€Eruda Networkæ ‡ç­¾é¡µ
2. æ£€æŸ¥APIè¯·æ±‚çš„URLï¼Œåº”è¯¥éƒ½æ˜¯éƒ¨ç½²ç¯å¢ƒçš„URL
3. ä¸åº”è¯¥æœ‰localhostçš„è¯·æ±‚

## ğŸ“‹ ä¿®å¤æ–‡ä»¶æ¸…å•

- âœ… `mobile.html` - ä¿®å¤Erudaåˆå§‹åŒ–ã€ä¿®å¤getApiConfigå‡½æ•°

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œç§»åŠ¨ç«¯åº”è¯¥ï¼š
1. âœ… é¡µé¢ç«‹å³æ˜¾ç¤ºå†…å®¹ï¼ˆä¸å†æ˜¯ç©ºç™½ï¼‰
2. âœ… Erudaè°ƒè¯•å·¥å…·å»¶è¿ŸåŠ è½½ï¼Œä¸å½±å“é¡µé¢æ¸²æŸ“
3. âœ… è‡ªåŠ¨ç™»å½•ä½¿ç”¨æ­£ç¡®çš„éƒ¨ç½²ç¯å¢ƒURL
4. âœ… æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨æ­£ç¡®çš„URL
5. âœ… æ²¡æœ‰JavaScripté”™è¯¯

---

**ä¿®å¤æ—¶é—´**ï¼š2025-12-26
**çŠ¶æ€**ï¼šå·²ä¿®å¤ï¼Œç­‰å¾…éƒ¨ç½²éªŒè¯
**ç´§æ€¥ç¨‹åº¦**ï¼šğŸ”´ é«˜ï¼ˆé¡µé¢å®Œå…¨ç©ºç™½ï¼‰




