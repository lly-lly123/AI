# 🗄️ 大容量存储部署方案

> **针对存储为主要功能的网站，提供多方案大容量存储支持**

## 📋 存储方案对比

| 存储服务 | 免费额度 | 国内访问速度 | 推荐场景 | 实名要求 |
|---------|---------|-------------|---------|---------|
| **七牛云** | **10GB** | ⭐⭐⭐⭐⭐ 最快 | **大容量存储（推荐）** | ✅ 需要 |
| **Supabase Storage** | 1GB | ⭐⭐⭐⭐ 较快 | 小到中等存储 | ❌ 不需要 |
| **阿里云OSS** | 有免费额度 | ⭐⭐⭐⭐⭐ 快 | 大容量存储（备选） | ✅ 需要 |
| **腾讯云COS** | 有免费额度 | ⭐⭐⭐⭐⭐ 快 | 大容量存储（备选） | ✅ 需要 |

## 🎯 推荐方案：七牛云（免费10GB，国内最快）

### 为什么选择七牛云？

✅ **免费10GB存储空间** - 足够大多数项目使用  
✅ **国内CDN加速** - 访问速度最快  
✅ **完全免费** - 免费额度内不收费  
✅ **简单易用** - API简洁，集成方便  
✅ **稳定可靠** - 国内主流云存储服务  

### 注册和配置步骤

#### 1. 注册七牛云账号

1. 访问：https://www.qiniu.com/
2. 点击 **"注册"** 或 **"免费注册"**
3. 完成注册和实名认证（免费使用需要实名）

#### 2. 创建存储空间（Bucket）

1. 登录七牛云控制台
2. 进入 **"对象存储"** → **"空间管理"**
3. 点击 **"新建空间"**
4. 填写信息：
   - **空间名称**：`pigeonai`（或您喜欢的名称）
   - **存储区域**：选择 **华东** 或 **华南**（离您最近）
   - **访问控制**：选择 **公开空间**（如果是公开文件）或 **私有空间**
5. 点击 **"确定创建"**

#### 3. 获取AccessKey和SecretKey

1. 点击右上角头像 → **"密钥管理"**
2. 点击 **"创建密钥"**
3. 记录以下信息：
   - **AccessKey**：类似 `xxxxxxxxxxxxx`
   - **SecretKey**：类似 `xxxxxxxxxxxxx`

#### 4. 获取存储空间域名

1. 在空间管理页面，点击您创建的存储空间
2. 在 **"域名管理"** 中找到 **"默认外链域名"**
3. 记录域名，例如：`pigeonai.qiniucs.com`

#### 5. 在Zeabur配置环境变量

在Zeabur控制台的 **Variables** 页面添加：

```env
QINIU_ACCESS_KEY=你的AccessKey
QINIU_SECRET_KEY=你的SecretKey
QINIU_BUCKET=pigeonai
QINIU_DOMAIN=pigeonai.qiniucs.com
```

### 安装七牛云SDK

在项目根目录运行：

```bash
cd backend && npm install qiniu
```

或者添加到 `backend/package.json` 的依赖中。

---

## 🔄 备选方案1：Supabase Storage（免费1GB）

如果存储需求较小（<1GB），可以使用Supabase Storage。

### 配置步骤

1. **创建Supabase项目**（如果还没有）：
   - 访问：https://supabase.com
   - 创建项目并获取URL和Key

2. **创建存储Bucket**：
   - 在Supabase控制台，进入 **Storage**
   - 点击 **"New bucket"**
   - 名称：`files`
   - 权限：选择 **Public**（公开访问）或 **Private**（私有）

3. **在Zeabur配置环境变量**：

```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_STORAGE_BUCKET=files
```

---

## 🔄 备选方案2：阿里云OSS

如果需要更大的存储空间和更好的性能。

### 配置步骤

1. **注册阿里云账号**：https://www.aliyun.com/
2. **开通OSS服务**：在控制台开通对象存储OSS
3. **创建Bucket**：
   - 名称：`pigeonai`
   - 地域：选择 **华东1（杭州）** 或其他国内地域
4. **获取AccessKey**：在 **AccessKey管理** 中创建
5. **在Zeabur配置环境变量**：

```env
ALIYUN_OSS_ACCESS_KEY_ID=你的AccessKeyId
ALIYUN_OSS_ACCESS_KEY_SECRET=你的AccessKeySecret
ALIYUN_OSS_BUCKET=pigeonai
ALIYUN_OSS_REGION=oss-cn-hangzhou
```

### 安装阿里云OSS SDK

```bash
cd backend && npm install ali-oss
```

---

## 💾 存储服务自动选择机制

系统会自动按以下优先级选择存储服务：

1. **七牛云**（如果配置）- 优先使用，容量最大（10GB）
2. **Supabase Storage**（如果配置）- 备选方案（1GB）
3. **阿里云OSS**（如果配置）- 备选方案（按需付费）

**故障转移**：如果主存储服务失败，自动切换到下一个可用的服务。

---

## 🚀 使用文件存储服务

### 在代码中上传文件

```javascript
const fileStorageService = require('./services/fileStorageService');

// 上传文件
const result = await fileStorageService.uploadFile(
  fileBuffer,           // 文件内容（Buffer）
  'example.jpg',        // 文件名
  'uploads'             // 存储文件夹（可选）
);

console.log('文件URL:', result.url);
console.log('文件Key:', result.key);
console.log('存储提供商:', result.provider);
```

### 删除文件

```javascript
await fileStorageService.deleteFile('uploads/example_1234567890.jpg');
```

### 获取文件URL

```javascript
const url = fileStorageService.getFileUrl('uploads/example.jpg');
```

---

## 📊 存储容量说明

### 七牛云免费版

- ✅ **存储空间**：10GB
- ✅ **下载流量**：每月10GB
- ✅ **PUT请求**：每月100万次
- ✅ **GET请求**：每月1000万次
- ✅ **完全免费**：免费额度内不收费

### Supabase免费版

- ✅ **数据库**：500MB
- ✅ **文件存储**：1GB
- ✅ **带宽**：2GB/月
- ✅ **API请求**：无限

### Supabase付费版（Pro）

- 💰 **价格**：$25/月
- ✅ **数据库**：8GB（可扩展）
- ✅ **文件存储**：25GB（可扩展）
- ✅ **带宽**：250GB/月

---

## 🎯 推荐配置方案

### 方案A：完全免费（推荐）

**使用七牛云 + Supabase免费版**

- **七牛云**：存储用户上传的文件（10GB）
- **Supabase**：存储数据库和JSON数据（1GB文件 + 500MB数据库）

**总容量**：约11GB免费存储

### 方案B：大容量需求

**使用七牛云 + Supabase Pro**

- **七牛云**：存储用户上传的文件（10GB免费）
- **Supabase Pro**：存储数据库和大文件（25GB + 8GB数据库）

**总容量**：约43GB（$25/月）

---

## 📝 在Zeabur部署时的环境变量

完整的环境变量配置（选择您需要的存储服务）：

```env
# 必需配置
PORT=3000
NODE_ENV=production

# Supabase（数据库 + 可选文件存储）
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_STORAGE_BUCKET=files

# 七牛云（推荐，大容量存储）
QINIU_ACCESS_KEY=your-access-key
QINIU_SECRET_KEY=your-secret-key
QINIU_BUCKET=pigeonai
QINIU_DOMAIN=your-domain.qiniucs.com

# 阿里云OSS（可选）
ALIYUN_OSS_ACCESS_KEY_ID=your-access-key-id
ALIYUN_OSS_ACCESS_KEY_SECRET=your-secret-key
ALIYUN_OSS_BUCKET=pigeonai
ALIYUN_OSS_REGION=oss-cn-hangzhou

# AI配置（可选）
ZHIPU_API_KEY_EVO=your-zhipu-key
ZHIPU_API_KEY_ADMIN=your-zhipu-key
AI_MODEL=auto
```

---

## ✅ 部署检查清单

- [ ] 已注册七牛云账号并完成实名
- [ ] 已创建七牛云存储空间（Bucket）
- [ ] 已获取七牛云AccessKey和SecretKey
- [ ] 已在Zeabur配置七牛云环境变量
- [ ] 已安装qiniu SDK：`npm install qiniu`
- [ ] 已测试文件上传功能

---

## 🎉 完成！

配置完成后，您的网站将拥有：

- ✅ **大容量存储**：10GB+ 免费存储空间
- ✅ **国内高速访问**：CDN加速，速度快
- ✅ **自动故障转移**：多个存储服务备份
- ✅ **完全免费**：免费额度内不收费
- ✅ **长期使用**：稳定可靠，支持扩展

祝您使用愉快！🚀

































