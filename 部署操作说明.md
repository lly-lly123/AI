# 🚀 完全自动化部署到Zeabur - 一键操作指南

## 📋 部署方案说明

本方案使用 **Zeabur + 大容量云存储**，完全满足您的需求：
- ✅ **国内可访问**：无需VPN，访问速度快
- ✅ **大容量存储**：免费10GB+存储空间（七牛云推荐）
- ✅ **云端数据库**：Supabase免费云数据库
- ✅ **API Key配置**：支持在Zeabur控制台配置所有API密钥
- ✅ **完全免费**：免费额度充足，适合长期使用
- ✅ **自动更新**：代码推送后自动部署
- ✅ **长期运行**：24/7运行，不会休眠
- ✅ **文件存储**：支持图片、文档、视频等各类文件存储

---

## 🎯 第一步：一键执行部署命令

**直接复制以下命令到终端运行（在项目目录下）：**

```bash
cd /Users/macbookair/Desktop/AI && chmod +x 一键自动部署.sh && ./一键自动部署.sh
```

**或者更简单，直接运行：**

```bash
cd /Users/macbookair/Desktop/AI && bash 一键自动部署.sh
```

这个脚本会自动：
1. ✅ 检查所有配置文件
2. ✅ 自动提交代码更改
3. ✅ 推送到GitHub

---

## 🔧 第二步：在Zeabur创建项目（仅此一次）

### 2.1 登录Zeabur

1. 访问：https://zeabur.com
2. 点击右上角 **"Sign Up"** 或 **"登录"**
3. 推荐使用 **GitHub账号登录**（最方便）

### 2.2 创建项目

1. 登录后，点击 **"New Project"**（新建项目）
2. 输入项目名称，例如：`pigeonai`
3. 点击 **"Create"**

### 2.3 连接GitHub仓库

1. 在项目页面，点击 **"Add Service"**
2. 选择 **"GitHub"**
3. 授权Zeabur访问您的GitHub账号（如果首次使用）
4. 选择仓库：`lly-lly123/AI`
5. 点击 **"Deploy"**

### 2.4 配置构建命令（重要）

Zeabur会自动检测，但如果Build Command和Start Command为空，请手动配置：

1. 在服务页面，找到 **"Settings"** 或点击 **"Configure"**
2. 设置以下配置：
   - **Build Command**: `cd backend && npm install`
   - **Start Command**: `cd backend && npm start`
   - **Root Directory**: `.` (项目根目录)
   - **Node Version**: `18.x` 或 `20.x`

---

## 🔑 第三步：配置环境变量（API Key等）

### 3.1 打开环境变量设置

在Zeabur服务页面：
1. 点击 **"Variables"**（环境变量）标签页
2. 点击 **"Add Variable"**（添加变量）

### 3.2 添加必需的环境变量

依次添加以下变量（点击"Add Variable"添加每个）：

```env
PORT=3000
NODE_ENV=production
```

### 3.3 配置大容量文件存储（网站主要功能）

**推荐方案：七牛云（免费10GB，国内最快）**

1. **注册七牛云账号**：
   - 访问：https://www.qiniu.com/
   - 注册并完成实名认证（免费使用需要）

2. **创建存储空间**：
   - 登录控制台 → **对象存储** → **空间管理**
   - 点击 **"新建空间"**
   - 名称：`pigeonai`，区域：选择 **华东** 或 **华南**

3. **获取密钥**：
   - 右上角头像 → **密钥管理** → **创建密钥**
   - 记录 **AccessKey** 和 **SecretKey**

4. **获取域名**：
   - 空间管理 → 点击您的空间 → **域名管理**
   - 记录 **默认外链域名**

5. **在Zeabur添加环境变量**：

```env
QINIU_ACCESS_KEY=你的AccessKey
QINIU_SECRET_KEY=你的SecretKey
QINIU_BUCKET=pigeonai
QINIU_DOMAIN=你的域名.qiniucs.com
```

**备选方案：Supabase Storage（免费1GB）**

如果您还没有Supabase账号，先注册：
1. 访问：https://supabase.com
2. 使用GitHub账号登录
3. 创建新项目（选择新加坡或东京区域，离中国更近）
4. 在Supabase项目的 **Settings → API** 页面获取：
   - **Project URL** → 这就是 `SUPABASE_URL`
   - **anon public** key → 这就是 `SUPABASE_ANON_KEY`
5. 在 **Storage** 中创建Bucket，名称：`files`

然后在Zeabur添加：

```env
SUPABASE_URL=你的Supabase_URL（例如：https://xxxxx.supabase.co）
SUPABASE_ANON_KEY=你的Supabase_Anon_Key（很长的字符串）
SUPABASE_STORAGE_BUCKET=files
```

**💡 详细存储配置说明请查看：`大容量存储部署方案.md`**

### 3.4 添加AI API Key（可选，如需AI功能）

**智谱AI（推荐，国内可访问）：**
1. 访问：https://open.bigmodel.cn/
2. 注册并获取API Key
3. 在Zeabur添加：

```env
ZHIPU_API_KEY_EVO=你的智谱AI_Key（用于Evo智能助手）
ZHIPU_API_KEY_ADMIN=你的智谱AI_Key（用于中枢管家）
AI_MODEL=auto
```

### 3.5 添加其他配置

```env
API_KEY=your_api_key_here（自定义API密钥）
LOG_LEVEL=info
```

**完成所有环境变量配置后，点击保存！**

---

## ⏳ 第四步：等待部署完成

1. 配置完成后，Zeabur会自动开始构建和部署
2. 等待约 **3-5分钟**
3. 部署完成后，Zeabur会显示一个公网访问地址，例如：
   - `https://your-project-xxxxx.zeabur.app`

---

## ✅ 第五步：验证部署

1. 访问Zeabur提供的公网地址
2. 访问管理后台：`https://your-project-xxxxx.zeabur.app/admin.html`
3. 测试API功能

---

## 🔄 后续更新网站

以后更新网站非常简单，只需：

1. **修改代码**
2. **运行一键部署命令**：
   ```bash
   cd /Users/macbookair/Desktop/AI && bash 一键自动部署.sh
   ```
3. **Zeabur会自动检测GitHub更新并重新部署**（无需任何操作）

---

## 📖 详细文档

- **大容量存储配置**：查看 `大容量存储部署方案.md` - **必读！**
- **Supabase配置说明**：查看 `免费部署指南-Zeabur.md` 文件中的"第三步：创建Supabase免费云存储"部分
- **数据库初始化**：需要在Supabase的SQL Editor中执行 `supabase-schema.sql` 或 `supabase-init.sql`

---

## 🎉 完成！

部署完成后，您的网站将：
- ✅ 24/7运行
- ✅ 国内可直接访问
- ✅ 自动备份到云端
- ✅ 代码更新自动部署
- ✅ 完全免费使用

祝您使用愉快！🚀

